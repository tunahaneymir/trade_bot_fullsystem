📊 PARÇA 2: PA ENTRY & EXIT KURALLARI
🎯 1. ENTRY DETECTION (15M TIMEFRAME)
1.1 Genel Bakış
Entry süreci 2 adımdan oluşur:
ADIM 1: ChoCH (Change of Character) Detection
└─ Market structure kırılımı tespit et

ADIM 2: Fibonacci Retracement
└─ Geri çekilmeyi bekle, entry al
Neden 15M?
4H → Trend belirle
1H → Zone tespit et
15M → Entry timing (hassas giriş)

15M kullanmamızın sebepleri:
✓ Hassas entry point
✓ Daha iyi risk-reward
✓ Stop loss daha dar
✓ False signal'leri filtreler

📈 2. ChoCH (CHANGE OF CHARACTER) DETECTION
2.1 ChoCH Nedir?
Tanım: Market yapısının kırılması, trend değişim sinyali
Basit Açıklama:
Düşüş trendi devam ederken:
- Lower High (LH) → Lower Low (LL) → Lower High (LH)
- Bu yapı kırılır
- Yeni bir yükseliş başlar
→ Bu kırılıma ChoCH denir
2.2 ChoCH Kuralları
2.2.1 LONG İçin ChoCH
Ön Koşul: Düşüş yapısı (Lower Highs - Lower Lows)
Market Yapısı (Düşüş):
          LH
         ╱  ╲
        ╱    ╲  LH
       ╱      ╲╱  ╲
      ╱            ╲
    LL              LL

ChoCH Anı:
          LH (Son düşüş high'ı: $50,000)
         ╱  ╲
        ╱    ╲  
       ╱      ╲╱  
      ╱            
    LL              
                    ↗ Yeni mum burada KAPAR
                    New high: $50,200
                    
→ Son LH ($50,000) kırıldı (body close ile)
→ ChoCH CONFIRMED!
Kesin Kurallar:
# LONG ChoCH Koşulları
1. Son Lower High seviyesi belirli (örnek: $50,000)

2. Yeni bir mum oluşur ve:
   - Mum HIGH'ı son LH'yi aşar (wick OK)
   - Mum CLOSE son LH'nin ÜSTÜNDE ✓
   
3. Body close şart!
   ✗ Wick ile aşmak yetmez
   ✓ Close o seviyenin üstünde olmalı

Örnek:
Last LH: $50,000
New candle: 
├─ Open: $49,900
├─ High: $50,300 (wick yukarı)
├─ Low: $49,850
└─ Close: $50,150 ✓ (close > $50,000)

ChoCH: CONFIRMED!
False ChoCH (Yanlış Sinyal):
Son LH: $50,000

Senaryo 1: Wick ile dokundu
├─ High: $50,200 (wick LH'yi geçti)
└─ Close: $49,950 ✗ (close altında kaldı)
→ ChoCH YOK! False breakout

Senaryo 2: Gap ile atladı
├─ Open: $50,300 (gap yukarı)
└─ Close: $50,500 ⚠️
→ Suspicious! Güçlü ama risky

Senaryo 3: Clean break
├─ Open: $49,950
├─ High: $50,250
└─ Close: $50,180 ✓
→ Perfect ChoCH! Clean body close
2.2.2 SHORT İçin ChoCH
Ön Koşul: Yükseliş yapısı (Higher Highs - Higher Lows)
Market Yapısı (Yükseliş):
              HH
             ╱
            ╱    HH
       HL  ╱    ╱
         ╲╱    ╱
               ╱
          HL  ╱

ChoCH Anı:
              HH 
             ╱
            ╱    
       HL (Son yükseliş low'u: $51,000)
         ╲╱    
               
    ↘ Yeni mum burada KAPAR
    New low: $50,800
    
→ Son HL ($51,000) kırıldı (body close ile)
→ ChoCH CONFIRMED!
Kesin Kurallar:
# SHORT ChoCH Koşulları
1. Son Higher Low seviyesi belirli (örnek: $51,000)

2. Yeni bir mum oluşur ve:
   - Mum LOW'u son HL'yi kırar (wick OK)
   - Mum CLOSE son HL'nin ALTINDA ✓
   
3. Body close şart!
   
Örnek:
Last HL: $51,000
New candle:
├─ Open: $51,100
├─ High: $51,150
├─ Low: $50,700 (wick aşağı)
└─ Close: $50,850 ✓ (close < $51,000)

ChoCH: CONFIRMED!
2.3 ChoCH Strength (Güç) Hesaplama
Amaç: ChoCH ne kadar güçlü? (0.0 - 1.0)
def calculate_choch_strength(breakout_candle, previous_extreme):
    """
    ChoCH gücünü hesapla
    
    Faktörler:
    1. Body ne kadar geçti? (40% ağırlık)
    2. Volume ne kadar yüksek? (60% ağırlık)
    """
    
    # ─────────────────────────────────
    # 1. Body Distance (0.0 - 0.4)
    # ─────────────────────────────────
    # Close previous extreme'den ne kadar uzak?
    
    body_distance = abs(breakout_candle.close - previous_extreme)
    candle_range = abs(breakout_candle.high - breakout_candle.low)
    
    # Body'nin candle içindeki oranı
    body_ratio = body_distance / candle_range
    body_score = body_ratio * 0.4  # Max 0.4
    
    # ─────────────────────────────────
    # 2. Volume Confirmation (0.0 - 0.6)
    # ─────────────────────────────────
    # Volume ortalamanın kaç katı?
    
    current_volume = breakout_candle.volume
    avg_volume_20 = average_volume_last_20_candles()
    
    volume_ratio = current_volume / avg_volume_20
    
    # Volume scoring
    # 2x volume = 0.6 score (max)
    # 1x volume = 0.3 score
    # 0.5x volume = 0.15 score
    volume_score = min(volume_ratio / 2, 0.5) * 0.6
    
    # ─────────────────────────────────
    # Final Strength
    # ─────────────────────────────────
    strength = body_score + volume_score
    strength = min(strength, 1.0)  # Max 1.0
    
    return strength
Örnek Hesaplamalar:
═════════════════════════════════════════
ÖRNEK 1: GÜÇLÜ ChoCH (0.85)
═════════════════════════════════════════
Previous LH: $50,000

Breakout Candle:
├─ Open: $49,950
├─ High: $50,350
├─ Low: $49,900
├─ Close: $50,300
└─ Volume: 1,500 BTC

Avg Volume (20): 800 BTC

Hesaplama:
─────────────────────────────────────────
Body Distance:
├─ Distance: $50,300 - $50,000 = $300
├─ Candle Range: $50,350 - $49,900 = $450
├─ Ratio: $300 / $450 = 0.67
└─ Body Score: 0.67 * 0.4 = 0.27

Volume:
├─ Current: 1,500 BTC
├─ Average: 800 BTC
├─ Ratio: 1,500 / 800 = 1.875
├─ Score Calc: min(1.875/2, 0.5) * 0.6
└─ Volume Score: 0.5 * 0.6 = 0.30

TOTAL STRENGTH: 0.27 + 0.30 = 0.57 ✗

Wait, let me recalculate properly:

Volume Score calculation fix:
├─ Ratio: 1.875
├─ Normalized: 1.875 / 2 = 0.9375
├─ Capped: min(0.9375, 1.0) = 0.9375
└─ Volume Score: 0.9375 * 0.6 = 0.56

TOTAL: 0.27 + 0.56 = 0.83
→ STRONG ChoCH! ✓
─────────────────────────────────────────

═════════════════════════════════════════
ÖRNEK 2: ORTA ChoCH (0.55)
═════════════════════════════════════════
Previous LH: $50,000

Breakout Candle:
├─ Open: $49,980
├─ High: $50,200
├─ Low: $49,920
├─ Close: $50,100
└─ Volume: 900 BTC

Avg Volume: 800 BTC

Hesaplama:
─────────────────────────────────────────
Body Distance:
├─ Distance: $50,100 - $50,000 = $100
├─ Candle Range: $50,200 - $49,920 = $280
├─ Ratio: $100 / $280 = 0.36
└─ Body Score: 0.36 * 0.4 = 0.14

Volume:
├─ Ratio: 900 / 800 = 1.125
├─ Normalized: 1.125 / 2 = 0.56
└─ Volume Score: 0.56 * 0.6 = 0.34

TOTAL: 0.14 + 0.34 = 0.48
→ Medium ChoCH (Kabul edilebilir)
─────────────────────────────────────────

═════════════════════════════════════════
ÖRNEK 3: ZAYIF ChoCH (0.25)
═════════════════════════════════════════
Previous LH: $50,000

Breakout Candle:
├─ Open: $49,990
├─ High: $50,080
├─ Low: $49,950
├─ Close: $50,020
└─ Volume: 600 BTC

Avg Volume: 800 BTC

Hesaplama:
─────────────────────────────────────────
Body Distance:
├─ Distance: $50,020 - $50,000 = $20
├─ Candle Range: $50,080 - $49,950 = $130
├─ Ratio: $20 / $130 = 0.15
└─ Body Score: 0.15 * 0.4 = 0.06

Volume:
├─ Ratio: 600 / 800 = 0.75
├─ Normalized: 0.75 / 2 = 0.375
└─ Volume Score: 0.375 * 0.6 = 0.23

TOTAL: 0.06 + 0.23 = 0.29
→ WEAK ChoCH! ⚠️ (Riskli)
─────────────────────────────────────────
2.4 ChoCH Minimum Strength
MINIMUM_CHOCH_STRENGTH = 0.4  # 40%

# Neden 0.4?
"""
Strength < 0.4:
- Çok zayıf breakout
- False signal riski yüksek
- Volume yetersiz veya body küçük

Strength >= 0.4:
- Kabul edilebilir güç
- Breakout geçerli
- RL öğrenme için yeterli

RL Öğrenme:
- İlk aylar 0.4+ tüm ChoCH'ları dene
- Hangisi kazandırıyor?
- Strength 0.6+ mı daha iyi?
- Strength 0.4-0.5 riskli mi?
- Data topla, optimize et!

Muhtemel sonuç:
- Strength 0.6+ → %70 win rate
- Strength 0.4-0.6 → %55 win rate
→ RL threshold'u 0.6'ya çıkarabilir
"""

🎯 3. FIBONACCI RETRACEMENT
3.1 Fibonacci Nedir?
Tanım: ChoCH sonrası fiyatın geri çekilme (retracement) seviyeleri
Amaç:
	•	Daha iyi entry fiyatı
	•	Daha dar stop loss
	•	Daha yüksek risk-reward
3.2 Fibonacci Levels
FIB_ENTRY_LEVELS = [0.705, 0.618]  # Öncelik sırasıyla

# Neden bu seviyeler?
"""
0.705 Level (Optimal Entry Point - OEP):
- Smart Money seviyesi
- Institutional entry bölgesi
- En yüksek win rate
- Öncelikli level

0.618 Level (Golden Ratio):
- Klasik Fibonacci
- Yaygın kullanılan
- Backup entry
- 0.705 miss olursa
"""
3.3 Fibonacci Hesaplama
Formül:
# LONG için (Bullish ChoCH sonrası)
swing_low = last_swing_low_price   # ChoCH öncesi düşük
swing_high = choch_breakout_high   # ChoCH mumunun high'ı

# Fibonacci seviyeleri (yukarıdan aşağıya)
fib_0 = swing_high              # 0% (en üst)
fib_0705 = swing_low + (swing_high - swing_low) * (1 - 0.705)
fib_0618 = swing_low + (swing_high - swing_low) * (1 - 0.618)
fib_1 = swing_low               # 100% (en alt)

# SHORT için (Bearish ChoCH sonrası)
swing_high = last_swing_high_price  # ChoCH öncesi yüksek
swing_low = choch_breakout_low      # ChoCH mumunun low'u

# Fibonacci seviyeleri (aşağıdan yukarıya)
fib_0 = swing_low               # 0% (en alt)
fib_0705 = swing_high - (swing_high - swing_low) * (1 - 0.705)
fib_0618 = swing_high - (swing_high - swing_low) * (1 - 0.618)
fib_1 = swing_high              # 100% (en üst)
Görsel Örnek (LONG):
ChoCH Sonrası Fibonacci:

$50,500 ─────────────  0% (ChoCH high)
                    ↑
                    │ Breakout
$50,300 ─────────────
                    │
$50,151 ═════════════  0.705 Level ⭐ (ENTRY 1)
                    │
$50,109 ═════════════  0.618 Level ✓ (ENTRY 2)
                    │
$49,900 ─────────────
                    │ Retracement
$49,800 ─────────────  100% (Swing low)

Entry Logic:
1. ChoCH confirmed at $50,500
2. Fiyat geri çekiliyor
3. $50,151'e değdi → ENTRY! (0.705)
4. Değmedi, $50,109'a indi → ENTRY! (0.618)
5. İkisini de atladı → SETUP CANCEL!
3.4 Entry Logic (Fibonacci)
def check_fibonacci_entry(current_price, fib_levels, direction):
    """
    Fibonacci entry kontrolü
    """
    
    fib_0705 = fib_levels['0.705']
    fib_0618 = fib_levels['0.618']
    
    if direction == "LONG":
        # Fiyat yukarıdan aşağı iniyor (retracement)
        
        # Priority 1: 0.705 level
        if current_price <= fib_0705:
            return {
                'entry': True,
                'price': fib_0705,
                'level': '0.705',
                'quality': 'EXCELLENT'
            }
        
        # Priority 2: 0.618 level (0.705'i atladı)
        elif current_price <= fib_0618:
            return {
                'entry': True,
                'price': fib_0618,
                'level': '0.618',
                'quality': 'GOOD'
            }
        
        # Fiyat henüz retest yapmadı
        elif current_price > fib_0705:
            return {
                'entry': False,
                'reason': 'Waiting for retracement'
            }
        
        # Fiyat her iki leveli de atladı
        elif current_price < fib_0618:
            return {
                'entry': False,
                'reason': 'Missed both levels - CANCEL SETUP'
            }
    
    elif direction == "SHORT":
        # Fiyat aşağıdan yukarı çıkıyor (retracement)
        
        # Priority 1: 0.705 level
        if current_price >= fib_0705:
            return {
                'entry': True,
                'price': fib_0705,
                'level': '0.705',
                'quality': 'EXCELLENT'
            }
        
        # Priority 2: 0.618 level
        elif current_price >= fib_0618:
            return {
                'entry': True,
                'price': fib_0618,
                'level': '0.618',
                'quality': 'GOOD'
            }
3.5 Fibonacci Entry Scenarios
═════════════════════════════════════════
SENARYO 1: PERFECT ENTRY (0.705)
═════════════════════════════════════════
10:00 - ChoCH confirmed at $50,500
10:15 - Price retracing: $50,400
10:30 - Price: $50,250
10:45 - Price: $50,150 → TOUCHED 0.705!

ACTION: ENTRY at $50,151
Level: 0.705 (Optimal Entry Point)
Quality: EXCELLENT ⭐
─────────────────────────────────────────

═════════════════════════════════════════
SENARYO 2: BACKUP ENTRY (0.618)
═════════════════════════════════════════
10:00 - ChoCH confirmed at $50,500
10:15 - Price retracing: $50,400
10:30 - Price: $50,250
10:45 - Price: $50,140 (skipped 0.705!)
11:00 - Price: $50,109 → TOUCHED 0.618!

ACTION: ENTRY at $50,109
Level: 0.618 (Golden Ratio)
Quality: GOOD ✓
Reason: Missed 0.705 but caught 0.618
─────────────────────────────────────────

═════════════════════════════════════════
SENARYO 3: MISSED ENTRY (CANCEL)
═════════════════════════════════════════
10:00 - ChoCH confirmed at $50,500
10:15 - Price retracing: $50,400
10:30 - Price: $50,050 (skipped both!)
      → Passed 0.705 ($50,151)
      → Passed 0.618 ($50,109)

ACTION: CANCEL SETUP ✗
Reason: Momentum too strong, no retest
Result: Wait for next setup
─────────────────────────────────────────

═════════════════════════════════════════
SENARYO 4: NO RETRACEMENT (CANCEL)
═════════════════════════════════════════
10:00 - ChoCH confirmed at $50,500
10:15 - Price: $50,700 (going up!)
10:30 - Price: $50,900 (no retracement)
10:45 - Price: $51,100 (train left!)

ACTION: CANCEL SETUP ✗
Reason: No retracement happened
Result: Missed opportunity, wait for next
─────────────────────────────────────────

🛑 4. STOP LOSS
4.1 Stop Loss Kuralı
Basit Kural: Son swing wick'in %0.5 dışı
STOP_BUFFER = 0.005  # 0.5%

def calculate_stop_loss(direction, last_swing_wick):
    """
    Stop loss hesapla
    
    Parameters:
    - direction: "LONG" or "SHORT"
    - last_swing_wick: Son swing'in wick seviyesi
    """
    
    if direction == "LONG":
        # LONG için swing low'un ALTItop_loss = last_swing_wick * (1 - STOP_BUFFER)
        
    elif direction == "SHORT":
        # SHORT için swing high'ın ÜSTÜ
        stop_loss = last_swing_wick * (1 + STOP_BUFFER)
    
    return stop_loss
4.2 LONG Stop Loss Örnek
Setup:
──────────────────────────────────────
ChoCH: $50,500
Fib Entry: $50,150 (0.705 level)
Last Swing Low: $49,800 (wick tam low)

Stop Loss Hesaplama:
──────────────────────────────────────
Last swing wick: $49,800
Buffer: 0.5%
Stop Loss: $49,800 * (1 - 0.005)
         = $49,800 * 0.995
         = $49,551

Risk:
──────────────────────────────────────
Entry: $50,150
Stop: $49,551
Risk: $50,150 - $49,551 = $599 per coin

Görsel:
──────────────────────────────────────
$50,500 ─────  ChoCH seviyesi
         ↗
$50,150 ═════  ENTRY (Fib 0.705)
         ↓
         │ Retracement zone
         ↓
$49,800 ─────  Last swing low (wick)
         ↓
$49,551 ═════  STOP LOSS (0.5% buffer)
         ✗ Stop hit ise trade kapanır
4.3 SHORT Stop Loss Örnek
Setup:
──────────────────────────────────────
ChoCH: $49,500
Fib Entry: $49,850 (0.705 level)
Last Swing High: $50,200 (wick tam high)

Stop Loss Hesaplama:
──────────────────────────────────────
Last swing wick: $50,200
Buffer: 0.5%
Stop Loss: $50,200 * (1 + 0.005)
         = $50,200 * 1.005
         = $50,451

Risk:
──────────────────────────────────────
Entry: $49,850
Stop: $50,451
Risk: $50,451 - $49,850 = $601 per coin

Görsel:
──────────────────────────────────────
$50,451 ═════  STOP LOSS (0.5% buffer)
         ✗ Stop hit ise trade kapanır
         ↑
$50,200 ─────  Last swing high (wick)
         ↑
         │ Retracement zone
         ↑
$49,850 ═════  ENTRY (Fib 0.705)
         ↘
$49,500 ─────  ChoCH seviyesi
4.4 Neden %0.5 Buffer?
Buffer olmadan:
─────────────────────────────────────
Stop Loss tam swing wick'te:
- Fiyat wick'e dokunur
- Stop hit
- Sonra bounce olur
→ Erken stop! ✗

%0.5 Buffer ile:
─────────────────────────────────────
Stop Loss biraz daha aşağıda (LONG):
- Fiyat wick'e dokun ur
- Ama stop'a ulaşmaz
- Bounce olur
- Trade devam eder ✓

Ancak:
- Zone gerçekten kırılırsa
- %0.5 geçer
- Stop hit (doğru)
→ Gerçek kırılımı yakalar ✓

🎯 5. TAKE PROFIT (Kademeli Çıkış)
5.1 TP Distribution (Dağılım)
TP_DISTRIBUTION = {
    'tp1': 0.50,  # %50 pozisyon
    'tp2': 0.30,  # %30 pozisyon
    'tp3': 0.20   # %20 pozisyon (trailing)
}

# Neden kademeli?
"""
Avantajlar:
✓ Risk azaltma (TP1'de kar garanti)
✓ Trend devam ederse kazanç artır (TP2, TP3)
✓ Psikolojik rahatlık (breakeven sonrası)
✓ Optimum risk-reward dengesi
"""
5.2 TP Hesaplama
def calculate_take_profits(entry, stop, direction):
    """
    Take profit seviyelerini hesapla
    """
    
    # Risk miktarı
    risk = abs(entry - stop)
    
    # ─────────────────────────────────
    # TP1: Risk-Reward 1.5 (Garantili)
    # ─────────────────────────────────
    if direction == "LONG":
        tp1 = entry + (risk * 1.5)
    else:  # SHORT
        tp1 = entry - (risk * 1.5)
    
    # ─────────────────────────────────
    # TP2: Likidite veya Karşı Zone
    # ─────────────────────────────────
    # En yakın likidite seviyesi veya
    # Karşıt zone'u bul
    tp2 = find_next_liquidity_or_zone(entry, direction)
    
    # Eğer TP2 çok yakınsa (RR < 2.5)
    # O zaman daha yukarıdaki zone'a bak
    if abs(tp2 - entry) / risk < 2.5:
        tp2 = find_next_zone_beyond(tp2, direction)
    
    # ─────────────────────────────────
    # TP3: Dinamik (ChoCH sinyali)
    # ─────────────────────────────────
    # Runtime'da belirlenir
    # Karşı yönde ChoCH oluşana kadar tut
    tp3 = None  # Trade sırasında güncellenecek
    
    return {
        'tp1': {
            'price': tp1,
            'size': 0.50,  # %50
            'rr': 1.5,
            'reason': 'Guaranteed profit'
        },
        'tp2': {
            'price': tp2,
            'size': 0.30,  # %30
            'rr': calculate_rr(entry, stop, tp2),
            'reason': 'Liquidity/Zone target'
        },
        'tp3': {
            'price': tp3,
            'size': 0.20,  # %20
            'rr': 'Dynamic',
            'reason': 'Trail until ChoCH'
        }
    }
5.3 TP Execution (Uygulama)
═════════════════════════════════════════
COMPLETE TP FLOW
═════════════════════════════════════════

ENTRY:
──────────────────────────────────────
Entry: $50,150
Stop Loss: $49,551
Risk: $599
Position: 1.0 BTC

TP Hesaplama:
──────────────────────────────────────
TP1 (RR 1.5):
├─ $50,150 + ($599 * 1.5)
├─ $50,150 + $898.50
└─ $51,048.50

TP2 (Next zone: $51,500):
├─ Zone detected at $51,500
├─ RR: ($51,500 - $50,150) / $599
└─ RR: 2.25

TP3 (Dynamic):
└─ Karşı ChoCH oluşana kadar

═════════════════════════════════════════
TRADE EXECUTION
═════════════════════════════════════════

STAGE 1: Entry Sonrası
──────────────────────────────────────
Position: 1.0 BTC @ $50,150
Stop: $49,551
TP1: $51,048 (waiting)
TP2: $51,500 (waiting)
TP3: Dynamic

STAGE 2: TP1 Hit! 🎯
──────────────────────────────────────
Price reaches: $51,048
Action: Close 50% (0.5 BTC)
Profit: 0.5 BTC * $898 = $449
Remaining: 0.5 BTC

CRITICAL: Move SL to Breakeven!
├─ Old SL: $49,551
└─ New SL: $50,150 (entry price)

Result: Risk eliminated! ✓
Worst case: Close at breakeven

STAGE 3: TP2 Hit! 🎯🎯
──────────────────────────────────────
Price reaches: $51,500
Action: Close 30% (0.3 BTC)
Profit: 0.3 BTC * $1,350 = $405
Remaining: 0.2 BTC

Action: Trail Stop Loss
├─ Current: $50,150 (breakeven)
├─ New: $51,048 (TP1 level)
└─ Locked profit: $898 * 0.2 = $180

Result: Guaranteed profit locked! ✓

STAGE 4: TP3 (Trailing) 📈
──────────────────────────────────────
Price continues: $51,800
Remaining: 0.2 BTC
Stop trailing at: $51,300

Monitoring for ChoCH:
├─ Watch for opposite direction ChoCH
├─ Watch for new swing formation
└─ When detected → Close final 20%

Scenarios:

A) ChoCH at $52,500:
   ├─ Close 0.2 BTC at $52,500
   ├─ Final profit: 0.2 * $2,350 = $470
   └─ Total trade profit: $449 + $405 + $470 = $1,324

B) Trailing stop hit at $51,300:
   ├─ Close 0.2 BTC at $51,300
   ├─ Final profit: 0.2 * $1,150 = $230
   └─ Total trade profit: $449 + $405 + $230 = $1,084

═════════════════════════════════════════
PROFIT SUMMARY
═════════════════════════════════════════

Initial Position: 1.0 BTC
Entry: $50,150
Total Risk: $599 (1.0 BTC)

Exits:
├─ TP1 (50%): +$449 @ RR 1.5
├─ TP2 (30%): +$405 @ RR 2.25
└─ TP3 (20%): +$230-470 @ RR 1.9-3.9

Total Profit: $1,084 - $1,324
Average RR: 1.8 - 2.2

Risk: $599
Reward: $1,084 - $1,324
Final RR: 1.8 - 2.2 ✓
═════════════════════════════════════════
5.4 Trailing Stop Logic (TP3)
def trail_stop_loss(current_price, entry, current_sl, direction):
    """
    Trailing stop loss güncellemesi
    """
    
    if direction == "LONG":
        # Fiyat yükseldikçe SL'i yukarı çek
        
        # Her yeni swing low oluştuğunda
        # SL'i o swing'in altına al
        
        new_swing_low = detect_new_swing_low()
        
        if new_swing_low > current_sl:
            # Yeni swing daha yüksekte
            new_sl = new_swing_low * 0.995  # 0.5% buffer
            return new_sl
        
        # Alternatif: Sabit trailing
        # Entry'den %X uzaklaştıkça SL çek
        profit_percent = (current_price - entry) / entry
        
        if profit_percent > 0.03:  # %3+ kar
            # SL'i entry + %1.5'e çek
            new_sl = entry * 1.015
            return new_sl
        
        return current_sl
    
    elif direction == "SHORT":
        # Fiyat düştükçe SL'i aşağı çek
        
        new_swing_high = detect_new_swing_high()
        
        if new_swing_high < current_sl:
            new_sl = new_swing_high * 1.005
            return new_sl
        
        return current_sl
5.5 ChoCH Exit Signal (TP3 için)
def check_choch_exit_signal(direction, current_position):
    """
    Karşı yönde ChoCH oluştu mu? (TP3 kapatma sinyali)
    """
    
    if direction == "LONG":
        # LONG pozisyondayız
        # SHORT ChoCH arıyoruz (exit için)
        
        # Son yükseliş yapısına bak
        last_higher_low = find_last_higher_low()
        
        # Yeni mum bu HL'yi kırdı mı?
        new_candle_close = get_current_candle_close()
        
        if new_candle_close < last_higher_low:
            # SHORT ChoCH oluştu!
            return {
                'exit_signal': True,
                'reason': 'Bearish ChoCH detected',
                'exit_price': current_price,
                'action': 'Close remaining 20%'
            }
        
        return {'exit_signal': False}
    
    elif direction == "SHORT":
        # SHORT pozisyondayız
        # LONG ChoCH arıyoruz
        
        last_lower_high = find_last_lower_high()
        new_candle_close = get_current_candle_close()
        
        if new_candle_close > last_lower_high:
            return {
                'exit_signal': True,
                'reason': 'Bullish ChoCH detected',
                'exit_price': current_price,
                'action': 'Close remaining 20%'
            }
        
        return {'exit_signal': False}

🔄 6. COMPLETE ENTRY-EXIT EXAMPLE
═════════════════════════════════════════════════════════
ÖRNEK: TAM TRADE AKIŞI (LONG)
═════════════════════════════════════════════════════════

📅 TIME: 10:00 - Trend & Zone Analysis
─────────────────────────────────────────────────────────
Coin: BTCUSDT
Timeframe: 4H → Trend check
├─ EMA 20: $50,500
├─ EMA 50: $49,800
├─ Price: $50,200
└─ Status: ✓ UPTREND

Timeframe: 1H → Zone detection
├─ Zone found: $50,000 - $50,100
├─ Zone quality: 8/10
├─ Touch count: 2
└─ Status: ✓ VALID ZONE

─────────────────────────────────────────────────────────

📅 TIME: 10:15 - ChoCH Detection
─────────────────────────────────────────────────────────
Timeframe: 15M
Price approaching zone: $50,050

Market structure:
├─ Previous structure: Downtrend
├─ Lower High: $50,000
├─ Lower Low: $49,800

New candle:
├─ Open: $49,980
├─ High: $50,350
├─ Low: $49,920
├─ Close: $50,280 ✓ (closed above LH)
└─ Volume: 1,800 BTC (2.1x average)

ChoCH Strength Calculation:
├─ Body distance: $50,280 - $50,000 = $280
├─ Candle range: $50,350 - $49,920 = $430
├─ Body ratio: $280/$430 = 0.65
├─ Body score: 0.65 * 0.4 = 0.26
├─ Volume ratio: 1,800/850 = 2.12
├─ Volume score: min(2.12/2, 1.0) * 0.6 = 0.6
└─ TOTAL STRENGTH: 0.86 ⭐ (STRONG!)

Status: ✓ ChoCH CONFIRMED

─────────────────────────────────────────────────────────

📅 TIME: 10:30 - Fibonacci Retracement
─────────────────────────────────────────────────────────
Swing points:
├─ Swing Low: $49,800 (before ChoCH)
├─ Swing High: $50,350 (ChoCH candle high)
└─ Range: $550

Fibonacci levels:
├─ Fib 0.705: $49,800 + ($550 * 0.295) = $49,962
├─ Fib 0.618: $49,800 + ($550 * 0.382) = $50,010
└─ Waiting for retracement...

10:35 - Price: $50,280 (no retracement yet)
10:45 - Price: $50,150 (retracing)
10:50 - Price: $50,050 (getting close)
11:00 - Price: $49,965 ✓ TOUCHED 0.705!

Entry Signal: ✓ CONFIRMED
Entry Price: $49,962 (Fib 0.705)
Entry Quality: EXCELLENT ⭐

─────────────────────────────────────────────────────────

📅 TIME: 11:00 - ENTRY EXECUTION
─────────────────────────────────────────────────────────

Position Details:
├─ Entry: $49,962
├─ Last swing low: $49,800
├─ Stop Loss: $49,800 * 0.995 = $49,551
├─ Risk per coin: $49,962 - $49,551 = $411

Account Balance: $10,000
Risk: 2% = $200
Position Size: $200 / $411 = 0.486 BTC

Take Profit Levels:
├─ TP1 (RR 1.5): $49,962 + ($411 * 1.5) = $50,579
├─ TP2 (Next zone): $51,200 (detected)
└─ TP3: Dynamic (ChoCH signal)

Trade Opened:
├─ Size: 0.486 BTC
├─ Entry: $49,962
├─ Stop: $49,551
├─ TP1: $50,579 (50% - 0.243 BTC)
├─ TP2: $51,200 (30% - 0.146 BTC)
└─ TP3: Dynamic (20% - 0.097 BTC)

─────────────────────────────────────────────────────────

📅 TIME: 13:30 - TP1 HIT! 🎯
─────────────────────────────────────────────────────────
Price: $50,579

Action: Close 50% position
├─ Close: 0.243 BTC @ $50,579
├─ Entry: 0.243 BTC @ $49,962
└─ Profit: 0.243 * ($50,579 - $49,962) = $150

Move SL to Breakeven:
├─ Old SL: $49,551
└─ New SL: $49,962 (entry)

Trade Status:
├─ Remaining: 0.243 BTC
├─ Profit locked: $150
└─ Risk: ELIMINATED ✓

─────────────────────────────────────────────────────────

📅 TIME: 15:45 - TP2 HIT! 🎯🎯
─────────────────────────────────────────────────────────
Price: $51,200

Action: Close 30% position
├─ Close: 0.146 BTC @ $51,200
├─ Entry: 0.146 BTC @ $49,962
└─ Profit: 0.146 * ($51,200 - $49,962) = $181

Trail Stop Loss:
├─ Current SL: $49,962 (breakeven)
├─ New swing low: $50,500
└─ New SL: $50,500 * 0.995 = $50,248

Trade Status:
├─ Remaining: 0.097 BTC (20%)
├─ Total profit: $150 + $181 = $331
└─ Locked profit: 0.097 * ($50,248 - $49,962) = $28

─────────────────────────────────────────────────────────

📅 TIME: 18:20 - TP3 EXIT (ChoCH Signal) 🎯🎯🎯
─────────────────────────────────────────────────────────
Price: $51,850

Market structure change detected:
├─ New higher low: $51,500
├─ New candle closed below: $51,450
└─ BEARISH ChoCH CONFIRMED!

Action: Close final 20%
├─ Close: 0.097 BTC @ $51,850
├─ Entry: 0.097 BTC @ $49,962
└─ Profit: 0.097 * ($51,850 - $49,962) = $183

─────────────────────────────────────────────────────────

📊 FINAL TRADE SUMMARY
═════════════════════════════════════════════════════════

Position: 0.486 BTC
Entry: $49,962
Average Exit: $50,997

Exits:
├─ TP1 (50%): $150 profit @ RR 1.5
├─ TP2 (30%): $181 profit @ RR 3.0
└─ TP3 (20%): $183 profit @ RR 4.6

Total Profit: $514
Total Risk: $200 (2% of $10,000)
Actual RR: $514 / $200 = 2.57

ROI: 5.14%
Win: ✓

═════════════════════════════════════════════════════════

✅ PARÇA 2 ÖZET
Bu parçada öğrendiklerimiz:
1. ChoCH Detection
	•	✅ Market structure break tespiti
	•	✅ LONG/SHORT ChoCH kuralları
	•	✅ ChoCH strength hesaplama (0.0-1.0)
	•	✅ Minimum strength: 0.4
2. Fibonacci Retracement
	•	✅ 0.705 ve 0.618 seviyeleri
	•	✅ Entry priority (0.705 önce)
	•	✅ Retracement bekleme mantığı
	•	✅ Setup iptal koşulları
3. Stop Loss
	•	✅ Son swing wick + 0.5% buffer
	•	✅ LONG/SHORT hesaplama
	•	✅ Risk belirleme
4. Take Profit (Kademeli)
	•	✅ TP1 (50%): RR 1.5 garantili
	•	✅ TP2 (30%): Likidite/Zone hedefi
	•	✅ TP3 (20%): ChoCH'a kadar trail
	•	✅ SL yönetimi (breakeven, trail)
5. Complete Trade Flow
	•	✅ Entry'den exit'e tam süreç
	•	✅ Her aşamada karar mekanizması
	•	✅ Risk-reward optimizasyonu

Sırada: PARÇA 3 - PA Adaptive & Re-entry (Re-entry kuralları, Adaptive parametreler, Liquidity, Complete flow)
Devam edelim mi? 🚀
